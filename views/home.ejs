<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta
      name="description"
      content="Book ferry tickets across Andaman Islands seamlessly with Makruzz."
    />
    <meta name="author" content="Makruzz Team" />

    <!-- ✅ Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <title>Makruzz Ferry Booking System</title>
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico" />
    <link href="/css/styles.css" rel="stylesheet" />

    <style>
      header {
  background-image: url('/assets/ferryimage.jpeg'); /* Replace with your image path */
  background-size: cover;       /* Make image cover the full area */
  background-position: center;  /* Center the image */
  background-repeat: no-repeat; /* Prevent tiling */
  color: white;                 /* Ensure text stays visible */
  padding: 100px 0;             /* Add vertical spacing */
  position: relative;
}

@media (max-width: 768px) {
  header {
    padding: 60px 0; /* Reduce padding on smaller screens */
  }
}


    </style>

<style>
  .step {
    flex: 1;
    position: relative;
  }

  .circle {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #dee2e6;
    color: #6c757d;
    line-height: 40px;
    margin: 0 auto;
    font-weight: bold;
  }

  .label {
    margin-top: 8px;
    font-size: 0.9rem;
  }

  .step.completed .circle {
    background-color: #198754; /* Bootstrap's green */
    color: white;
  }

  .step::after {
    content: '';
    position: absolute;
    top: 20px;
    right: -50%;
    width: 100%;
    height: 2px;
    background-color: #dee2e6;
    z-index: -1;
  }

  .step:last-child::after {
    display: none;
  }

  .step.completed::after {
    background-color: #198754;
  }
</style>

  </head>
  <body id="page-top">
    <!-- Navigation -->
    <nav
      class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top"
      id="mainNav"
    >
      <div class="container px-4">
        <a class="navbar-brand" href="#page-top">Makruzz Booking</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarResponsive"
          aria-controls="navbarResponsive"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="#about">Why Makruzz</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#bookings">Booking</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#services">Ferry Services</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#contact">Contact Support</a>
            </li>

          </ul>
        </div>
      </div>
    </nav>

    <!-- Header -->
    <header class="bg-primary bg-gradient text-white">
      <div class="container px-4 text-center   header" >
        <h1 class="fw-bolder">Welcome to Makruzz Booking</h1>
        <p class="lead">
          Fast, reliable, and easy ferry booking across the Andaman Islands
        </p>
        <a class="btn btn-lg btn-light" href="#about">Explore More</a>
      </div>
    </header>

    <!-- Steeper -->
     <!-- Stepper Container -->
<div class="d-flex justify-content-between align-items-center mb-4 mt-4">
  <div class="step text-center">
    <div class="circle">1</div>
    <div class="label">Fill up Form Accordingly</div>
  </div>
  <div class="step text-center">
    <div class="circle">2</div>
    <div class="label">Pick up Suitable Ferry</div>
  </div>
  <div class="step text-center">
    <div class="circle">3</div>
    <div class="label">Make Payment and Recieve Ticket</div>
  </div>

  
</div>

    <!-- Forms -->

    <div class="container mt-4">
      <nav>
        <div class="nav nav-tabs" id="nav-tab" role="tablist">
          <button
            class="nav-link active"
            id="nav-home-tab"
            data-bs-toggle="tab"
            data-bs-target="#nav-home"
            type="button"
            role="tab"
            aria-controls="nav-home"
            aria-selected="true"
          >
          Single Trip (One-Way Trip)
          </button>
          <button
            class="nav-link"
            id="nav-profile-tab"
            data-bs-toggle="tab"
            data-bs-target="#nav-profile"
            type="button"
            role="tab"
            aria-controls="nav-profile"
            aria-selected="false"
          >
          Return Trip (Round Trip / Back and Forth)
          </button>
        </div>
      </nav>
      <div class="tab-content" id="nav-tabContent">
        <div
          class="tab-pane fade show active"
          id="nav-home"
          role="tabpanel"
          aria-labelledby="nav-home-tab"
          tabindex="0"
        >
          <div class="container mt-2">
            <form class="row g-2 align-items-center" id="singleTripForm">
            <!-- From Dropdown -->
    <div class="col-auto">
        <select class="form-select" name="from" required>
          <% sectors.forEach((sector, index) => { %>
            <option 
              value="<%= sector.id%>" 
              <%= index === 0 ? "selected" : "" %>>
              <%= sector.title %> (<%= sector.code %>)
            </option>
          <% }) %>
        </select>
      </div>
  
      <!-- To Dropdown -->
      <div class="col-auto">
        <select class="form-select" name="to" required>
          <% sectors.forEach((sector, index) => { %>
            <option 
              value="<%= sector.id %>" 
              <%= index === sectors.length - 1 ? "selected" : "" %>>
              <%= sector.title %> (<%= sector.code %>)
            </option>
          <% }) %>
        </select>
      </div>
              <!-- Date -->
              <div class="col-auto">
                <input type="date" id="date" class="form-control" />
              </div>

              <!-- Passengers -->
              <div class="col-auto">
                <input
                  type="number"
                  id="passengers"
                  class="form-control"
                  min="1"
                  placeholder="Passengers"
                />
              </div>

              <!-- Submit -->
              <div class="col-auto">
                <button type="submit" class="btn btn-primary mt-4">
                Check Out Schedule 
                </button>
              </div>
            </form>
          </div>
        </div>
        <div
          class="tab-pane fade"
          id="nav-profile"
          role="tabpanel"
          aria-labelledby="nav-profile-tab"
          tabindex="0"
        >
  <div class="container mt-2">
   <p>Working.......................................</p>
  </div>
        </div>
      </div>
    </div>
    <!-- Forms -->


    
    
    <!-- Booking Section  -->
    <section id="bookings">
      <div class="container px-4">
        <div class="row gx-4 justify-content-center">
          <div class="col-lg-8">
            <h2>Bookings</h2>
            <div class="container my-4"  id="allBookings">
   
              
            </div>
            
            
          </div>
        </div>
      </div>
    </section>
    <!-- About section -->
    <section id="about">
      <div class="container px-4">
        <div class="row gx-4 justify-content-center">
          <div class="col-lg-8">
            <h2>Why choose Makruzz?</h2>
            <p class="lead">
              Makruzz is the most trusted ferry service provider in the Andaman
              Islands. With our new booking platform, you can:
            </p>
            <ul>
              <li>Search and compare ferry routes easily</li>
              <li>Book tickets online with secure payments</li>
              <li>Get instant confirmations and updates</li>
              <li>Experience smooth and safe journeys across islands</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Services section -->
    <section class="bg-light" id="services">
      <div class="container px-4">
        <div class="row gx-4 justify-content-center">
          <div class="col-lg-8">
            <h2>Ferry Routes We Serve</h2>
            <p class="lead">
              We connect the most popular destinations in Andaman:
            </p>
            <ul>
              <li>Port Blair ↔ Havelock (Swaraj Dweep)</li>
              <li>Havelock ↔ Neil Island (Shaheed Dweep)</li>
              <li>Port Blair ↔ Neil Island</li>
              <li>Other seasonal and special routes</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Contact section -->
    <section id="contact">
      <div class="container px-4">
        <div class="row gx-4 justify-content-center">
          <div class="col-lg-8">
            <h2>Need Help?</h2>
            <p class="lead">
              Reach out to our 24/7 customer support team for any queries
              regarding your ferry booking, cancellations, or general questions.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="py-5 bg-dark">
      <div class="container px-4">
        <p class="m-0 text-center text-white">
          &copy; Makruzz Ferry Booking System 2025
        </p>
      </div>
    </footer>


    

<!-- Include Bootstrap 5 (required) -->
<script src="/js/scripts.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>




<script>
  const form = document.getElementById("singleTripForm");

  // Function to check if all required fields are filled
  function isFormComplete() {
    const from = form.elements["from"].value.trim();
    const to = form.elements["to"].value.trim();
    const date = document.getElementById("date").value.trim();
    const passengers = document.getElementById("passengers").value.trim();

    return from && to && date && passengers;
  }

  // Function to fetch schedule
  async function fetchScheduleIfComplete() {
    if (!isFormComplete()) return;

    const formData = {
      trip_type: "single_trip",
      from: form.elements["from"].value,
      to: form.elements["to"].value,
      date: document.getElementById("date").value,
      passengers: document.getElementById("passengers").value,
    };

    localStorage.setItem("lastInput", JSON.stringify(formData));

    try {
      const response = await fetch("/fetchSchedule", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(formData)
      });

      const result = await response.json();
      alert(result.message)
     
      if (result.status === "success") {
        localStorage.setItem("data", JSON.stringify(result.data));
     
        window.location.href = "/schedule_search";

      }
      
    } catch (error) {
      console.error("Error fetching schedule:", error.message);
    }
  }

  // Listen for any change inside the form
  form.addEventListener("input", function () {
    fetchScheduleIfComplete();
  });

  // Optional: Still handle form submit manually
  form.addEventListener("submit", async function (e) {
    e.preventDefault();
    fetchScheduleIfComplete();
  });
</script>


    <script>


window.onload = function () {

  const lastInput = JSON.parse(localStorage.getItem("lastInput"));

  if (lastInput) {
    const { date, passengers } = lastInput;
    if (date && passengers) {
      document.getElementById("date").value = date;
      document.getElementById("passengers").value = passengers;
    }
  }
  
 appendBookings();
};









function appendBookings() {
  const bookings = JSON.parse(localStorage.getItem("bookings"));
  const data = JSON.parse(localStorage.getItem("data"));
  const container = document.getElementById("allBookings");

  // Clear previous content
  container.innerHTML = "";

  // If no bookings
  if (!bookings || bookings.length === 0) {
    container.innerHTML = `
  <p class="lead">
    you have not booked any ferry so far , Just fill up form  and explore
  </p>

  <ul>

    
    <li>Book tickets online with secure payments</li>

    
    
    <li>Download your ticket from your bookings section</li>
    <li>Cancel your tickets easily if plans change</li>
    <li>Print your ticket directly from this page as a PDF</li>
    <li>Your bookings will be displayed here for easy access</li>
  </ul>
`;

    return;
  }

  if (!data.data || !Array.isArray(data.data)) {
    container.innerHTML = `
      <div class="alert alert-danger text-center" role="alert">
        Schedule data not found. Please fetch the schedule again.
      </div>
    `;
    return;
  }

  

  bookings.forEach((booking) => {
    const schedule = data.data.find(item => item.id == booking.schedule_id);

    if (schedule) {

      
      const cardHTML = `
      <div class="card mb-3 shadow-sm" id="booking-${booking.booking_id}">
        <div class="card-body">
          <div class="row">
            <div class="col-md-8">
              <h5 class="card-title">${schedule.ship_title || "Ferry"} - ${schedule.display_name}</h5>
              <h6 class="card-subtitle text-muted mb-2">
                From: ${schedule.source_name} ➡️ To: ${schedule.destination_name} <br>
                Departure: ${schedule.departure_time} | Arrival: ${schedule.arrival_time}
              </h6>
              <p class="card-text mb-1">
                Travel Date: <strong>${booking.travel_date}</strong> <br>
                Trip Type: ${booking.booking_type || "N/A"} <br>
                Selected Class: <strong>${schedule.ship_class_title}</strong> <br>
                Class Price: ${schedule.ship_class_price}       <br>
                no_of_passenger : ${booking.no_of_passenger }
              </p>
              <p class="card-text mb-1">
                CGST (9%): ${schedule.cgst_amount} <br>
                UGST (9%): ${schedule.ugst_amount} <br>
                PSF: ${schedule.psf} <br>
                Total Price per  Passenger: <strong>${
                  parseFloat(schedule.ship_class_price) +
                  parseFloat(schedule.cgst_amount) +
                  parseFloat(schedule.ugst_amount) +
                  parseFloat(schedule.psf)
                }</strong>
                <br>
                Total Price: <strong>${
            (      parseFloat(schedule.ship_class_price) +
                  parseFloat(schedule.cgst_amount) +
                  parseFloat(schedule.ugst_amount) +
                  parseFloat(schedule.psf))*parseInt(booking.no_of_passenger)
                }</strong>
              </p>
            </div>
   <div class="col-md-4 text-md-end text-start mt-3 mt-md-0">
      
    
       
    
                <button class="btn btn-success mb-2" onclick="downloadTicket('${booking.booking_id}')">Download Ticket</button><br>
                <button class="btn btn-danger mb-2" onclick="cancelBooking(${booking.pnr})">Cancel Booking</button>
              
 
              
        </div>
          </div>
        </div>
      </div>
    `;

    container.insertAdjacentHTML("beforeend", cardHTML);
  
    } else {
      console.warn("No matching schedule found for booking:", booking);
    }
  });

}



function downloadTicket(booking_id) {
  fetch(`/downlaod/${booking_id}`, {
    method: "POST",
  })
  .then(response => response.json())
  .then(result => {

    console.log(result.data)
    downloadBase64PDF(result.data)
    
    

    
  })
  .catch(error => {
    console.error("Error confirming booking:", error);
    alert("Something went wrong while confirming your booking.");
  });
}




function downloadBase64PDF(base64String, filename = "ticket.pdf") {
  // Step 1: Convert base64 to byte array
  const byteCharacters = atob(base64String);
  const byteNumbers = Array.from(byteCharacters, char => char.charCodeAt(0));
  const byteArray = new Uint8Array(byteNumbers);

  // Step 2: Create a Blob with PDF type
  const blob = new Blob([byteArray], { type: "application/pdf" });

  // Step 3: Create a temporary anchor tag and click it to trigger download
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  document.body.appendChild(link);
  link.click();

  // Step 4: Clean up
  document.body.removeChild(link);
  URL.revokeObjectURL(link.href);
}




      </script>
      
      
      
  </body>
</html>
